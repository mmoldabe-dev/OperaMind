{% extends "base.html" %}

{% block title %}{{ conversation.filename }} - OperaMind{% endblock %}

{% block content %}
<div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
    <a href="{{ url_for('history') }}" style="color: #667eea; text-decoration: none; font-weight: 500;">
        ‚Üê –ù–∞–∑–∞–¥ –∫ –∏—Å—Ç–æ—Ä–∏–∏
    </a>
    
    {% if conversation.analysis %}
    <a href="{{ url_for('download_report', conversation_id=conversation.id) }}" class="btn" style="background: #27ae60;">
        üì• –°–∫–∞—á–∞—Ç—å –æ—Ç—á—ë—Ç
    </a>
    {% endif %}
</div>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 25px;">
        <div>
            <h2 style="color: #2c3e50; margin-bottom: 10px;">üìû {{ conversation.filename }}</h2>
            <p style="color: #7f8c8d;">
                –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {{ conversation.upload_date.strftime('%d.%m.%Y –≤ %H:%M') }}
            </p>
            <p style="margin-top: 10px;">
                –°—Ç–∞—Ç—É—Å: 
                {% if conversation.status == 'completed' %}
                    <span style="background: #27ae60; color: white; padding: 4px 12px; border-radius: 12px;">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                {% elif conversation.status == 'transcribing' %}
                    <span style="background: #3498db; color: white; padding: 4px 12px; border-radius: 12px;">üéß –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è...</span>
                {% elif conversation.status == 'analyzing' %}
                    <span style="background: #f39c12; color: white; padding: 4px 12px; border-radius: 12px;">ü§ñ –ê–Ω–∞–ª–∏–∑...</span>
                {% elif conversation.status == 'error' %}
                    <span style="background: #e74c3c; color: white; padding: 4px 12px; border-radius: 12px;">‚ùå –û—à–∏–±–∫–∞</span>
                {% else %}
                    <span style="background: #95a5a6; color: white; padding: 4px 12px; border-radius: 12px;">‚è≥ –û–∂–∏–¥–∞–µ—Ç</span>
                {% endif %}
            </p>
        </div>
        <form method="POST" action="{{ url_for('delete_conversation', conversation_id=conversation.id) }}" 
              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä?');">
            <button type="submit" class="btn btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </form>
    </div>

    {% if conversation.analysis %}
    <!-- –û–°–ù–û–í–ù–´–ï –ú–ï–¢–†–ò–ö–ò -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
        <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 20px; border-radius: 10px;">
            <p style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 5px;">–¢–ï–ú–ê</p>
            <p style="color: #2c3e50; font-weight: 600; font-size: 1.1rem;">{{ conversation.analysis.topic }}</p>
        </div>

        <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 20px; border-radius: 10px;">
            <p style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 5px;">–ö–ê–¢–ï–ì–û–†–ò–Ø</p>
            <p style="color: #2c3e50; font-weight: 600; font-size: 1.1rem;">{{ conversation.analysis.category }}</p>
        </div>

        <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 20px; border-radius: 10px;">
            <p style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 5px;">–¢–û–ù–ê–õ–¨–ù–û–°–¢–¨</p>
            {% if conversation.analysis.sentiment == '–ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π' %}
                <p style="font-weight: 600; font-size: 1.1rem; color: #27ae60;">{{ conversation.analysis.sentiment }}</p>
            {% elif conversation.analysis.sentiment == '–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π' %}
                <p style="font-weight: 600; font-size: 1.1rem; color: #e74c3c;">{{ conversation.analysis.sentiment }}</p>
            {% else %}
                <p style="font-weight: 600; font-size: 1.1rem; color: #f39c12;">{{ conversation.analysis.sentiment }}</p>
            {% endif %}
        </div>

        <div style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); padding: 20px; border-radius: 10px;">
            <p style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 5px;">–°–†–û–ß–ù–û–°–¢–¨</p>
            {% if conversation.analysis.urgency == '–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è' %}
                <p style="font-weight: 600; font-size: 1.1rem; color: #e74c3c;">{{ conversation.analysis.urgency }}</p>
            {% elif conversation.analysis.urgency == '–≤—ã—Å–æ–∫–∞—è' %}
                <p style="font-weight: 600; font-size: 1.1rem; color: #f39c12;">{{ conversation.analysis.urgency }}</p>
            {% elif conversation.analysis.urgency == '—Å—Ä–µ–¥–Ω—è—è' %}
                <p style="font-weight: 600; font-size: 1.1rem; color: #3498db;">{{ conversation.analysis.urgency }}</p>
            {% else %}
                <p style="font-weight: 600; font-size: 1.1rem; color: #95a5a6;">{{ conversation.analysis.urgency }}</p>
            {% endif %}
        </div>
    </div>

    <!-- –ö–ê–ß–ï–°–¢–í–û –û–ü–ï–†–ê–¢–û–†–ê -->
    {% if conversation.analysis.operator_quality %}
    <div style="background: #f8f9ff; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 4px solid #667eea;">
        <h3 style="color: #2c3e50; margin-bottom: 10px;">‚≠ê –ö–∞—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞</h3>
        <p style="font-size: 1.2rem; font-weight: 600; color: #667eea;">{{ conversation.analysis.operator_quality }}</p>
    </div>
    {% endif %}

    <!-- –ö–†–ê–¢–ö–û–ï –°–û–î–ï–†–ñ–ê–ù–ò–ï -->
    <div style="background: #f8f9ff; padding: 25px; border-radius: 10px; margin-bottom: 25px; border-left: 4px solid #667eea;">
        <h3 style="color: #2c3e50; margin-bottom: 15px;">üìù –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h3>
        <p style="color: #555; line-height: 1.8;">{{ conversation.analysis.summary }}</p>
    </div>

    <!-- –ü–û–î–†–û–ë–ù–´–ô –ê–ù–ê–õ–ò–ó -->
    {% if conversation.analysis.detailed_analysis %}
    <div style="background: #fff3cd; padding: 25px; border-radius: 10px; margin-bottom: 25px; border-left: 4px solid #ffc107;">
        <h3 style="color: #2c3e50; margin-bottom: 15px;">üîç –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h3>
        <p style="color: #555; line-height: 1.8; white-space: pre-line;">{{ conversation.analysis.detailed_analysis }}</p>
    </div>
    {% endif %}

    <!-- –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò -->
    {% if conversation.analysis.recommendations %}
    <div style="background: #d4edda; padding: 25px; border-radius: 10px; margin-bottom: 25px; border-left: 4px solid #28a745;">
        <h3 style="color: #2c3e50; margin-bottom: 15px;">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
        <p style="color: #555; line-height: 1.8; white-space: pre-line;">{{ conversation.analysis.recommendations }}</p>
    </div>
    {% endif %}

    <!-- –ö–õ–Æ–ß–ï–í–´–ï –°–õ–û–í–ê -->
    <div style="margin-bottom: 25px;">
        <h3 style="color: #2c3e50; margin-bottom: 15px;">üîë –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            {% if conversation.analysis.keywords %}
                {% set keywords = conversation.analysis.keywords|from_json %}
                {% for keyword in keywords %}
                <span style="background: #667eea; color: white; padding: 8px 16px; border-radius: 20px; font-weight: 500;">
                    {{ keyword }}
                </span>
                {% endfor %}
            {% endif %}
        </div>
    </div>

    <!-- –ü–û–õ–ù–ê–Ø –¢–†–ê–ù–°–ö–†–ò–ü–¶–ò–Ø -->
    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px;">
        <h3 style="color: #2c3e50; margin-bottom: 15px;">üìÑ –ü–æ–ª–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è</h3>
        <div style="background: white; padding: 20px; border-radius: 8px; max-height: 500px; overflow-y: auto; line-height: 1.8; color: #2c3e50; white-space: pre-line;">{{ conversation.analysis.transcript }}</div>
    </div>

    {% else %}
    <!-- –ù–ï–¢ –ê–ù–ê–õ–ò–ó–ê -->
    <div style="text-align: center; padding: 60px 20px; color: #7f8c8d;">
        <p style="font-size: 3rem; margin-bottom: 20px;">‚è≥</p>
        <h3 style="color: #2c3e50; margin-bottom: 10px;">–ê–Ω–∞–ª–∏–∑ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</h3>
        <p>–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è</p>
    </div>
    {% endif %}
</div>
{% endblock %}